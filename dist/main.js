(()=>{var t={982:(t,e,r)=>{var o=r(202);t.exports=(o.default||o).template({1:function(t,e,r,o,i){var n,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <div class="snow-editor-prop" data-value="'+t.escapeExpression("function"==typeof(n=null!=(n=s(r,"i")||(null!=e?s(e,"i"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"i",hash:{},data:i,loc:{start:{line:108,column:54},end:{line:108,column:59}}}):n)+'"></div>\r\n'},compiler:[8,">= 4.3.0"],main:function(t,e,r,o,i){var n,s,a=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,c="function",h=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="snow-editor" data-user-id="'+h(typeof(s=null!=(s=u(r,"userId")||(null!=e?u(e,"userId"):e))?s:l)===c?s.call(a,{name:"userId",hash:{},data:i,loc:{start:{line:1,column:39},end:{line:1,column:49}}}):s)+'">\r\n    <div class="snow-editor__tools">\r\n        <div class="snow-editor__buttons">\r\n            <div class="snow-editor-button" data-role="undo" title="Отмена последнего действия">\r\n                <svg width="20" height="20" viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">\r\n                    <path d="m257.78991,147.11723l0,-98.3439l-235.23521,171.41879l235.23521,171.4203l0,-104.38496c136.83237,-7.03767 228.89459,17.84729 230.89459,86.64318c11,126.17919 -140.0358,155.55076 -172.0358,169.55076l0,1.27479c0,0 262.906,11.33775 262.906,-240.90812c-20,-174.1745 -218.16914,-154.62136 -321.76479,-156.67084z"\r\n                          fill="currentColor"/>\r\n                </svg>\r\n            </div>\r\n        </div>\r\n        <div class="snow-editor-tool" data-role="add"></div>\r\n        <div class="snow-editor-tool" data-role="erase"></div>\r\n        <div class="snow-editor-tool" data-role="paint"></div>\r\n        <div class="snow-editor-tool" data-role="props"></div>\r\n        <div class="snow-editor__buttons">\r\n            <div class="snow-editor__button-free"></div>\r\n            <div class="snow-editor-button" data-role="clear" title="Удалить все">\r\n                <svg width="20" height="20" viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">\r\n                    <path d="m517.71969,442.21438l-142.97342,-142.97342l142.94743,-142.97342l-73.48761,-73.53958l-142.97342,142.97342l-142.97342,-142.97342l-73.48761,73.53958l142.94743,142.97342l-142.97342,142.97342l73.53958,73.5136l142.94743,-142.97342l142.94743,142.97342"\r\n                          fill="currentColor"/>\r\n                </svg>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="snow-editor__buttons">\r\n        <div class="snow-editor__shape" title="Сфера" data-shape="sphere">\r\n            <svg width="20" height="20" viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">\r\n                <path d="m-178.1,198.84472l0.56913,0l0.17587,-0.38196l0.17587,0.38196l0.56913,0l-0.46044,0.23606l0.17588,0.38196l-0.46044,-0.23607l-0.46044,0.23607l0.17588,-0.38196l-0.46044,-0.23606z"\r\n                      stroke="currentColor" fill="none"/>\r\n                <path stroke="currentColor" stroke-width="46"\r\n                      d="m298.49999,569.99997c-149.4475,0 -270.49998,-121.05248 -270.49998,-270.49998c0,-149.4475 121.05248,-270.49998 270.49998,-270.49998c149.4475,0 270.49998,121.05248 270.49998,270.49998c0,149.4475 -121.05248,270.49998 -270.49998,270.49998z"\r\n                      opacity="undefined" fill="none"/>\r\n                <path stroke="currentColor" d="m295,31.99999l1,538.015" stroke-width="46"\r\n                      fill="none"/>\r\n                <path d="m285,312" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <path d="m173,126" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <path d="m179,64" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <path d="m216,44c-66,113 -90,159 -92,262c-2,103 61,191 96,251" stroke-width="46"\r\n                      stroke="currentColor" fill="none"/>\r\n                <path transform="rotate(-179.906 419.029 299.017)"\r\n                      d="m467.05451,38.01558c-66,113 -94.00325,157.03778 -96.00325,260.03778c-2,103 59.00983,201.9655 94.00983,261.9655"\r\n                      stroke-width="46" stroke="currentColor" fill="none"/>\r\n            </svg>\r\n        </div>\r\n        <div class="snow-editor__shape" title="Круг" data-shape="circle">\r\n            <svg width="20" height="20" viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">\r\n                <path d="m-178.1,198.84472l0.56913,0l0.17587,-0.38196l0.17587,0.38196l0.56913,0l-0.46044,0.23606l0.17588,0.38196l-0.46044,-0.23607l-0.46044,0.23607l0.17588,-0.38196l-0.46044,-0.23606z" stroke="currentColor" fill="none"/>\r\n                <path stroke="currentColor" stroke-width="46" d="m298.49999,570.99997c-149.4475,0 -270.49998,-121.05248 -270.49998,-270.49998c0,-149.4475 121.05248,-270.49998 270.49998,-270.49998c149.4475,0 270.49998,121.05248 270.49998,270.49998c0,149.4475 -121.05248,270.49998 -270.49998,270.49998z" opacity="undefined" fill="none"/>\r\n                <line y2="44" x2="383" y1="334" x1="34" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <line y2="136" x2="501" y1="473" x1="99" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <path d="m219,559l349,-292" opacity="undefined" stroke-width="46" stroke="currentColor" fill="none"/>\r\n            </svg>\r\n        </div>\r\n        <div class="snow-editor__shape" title="Цилиндр" data-shape="cylinder">\r\n            <svg width="20" height="20" viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">\r\n                <ellipse ry="108" rx="271" id="svg_21" cy="138" cx="300" stroke-width="46" stroke="currentColor"\r\n                         fill="none"/>\r\n                <path d="m569,462" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <path transform="rotate(-179.817 299 521)" id="svg_23"\r\n                      d="m28,575c0,-59.66851 121.27624,-108 271,-108c149.72376,0 271,48.33149 271,108"\r\n                      opacity="undefined" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <line y2="579.05294" x2="301" y1="239" x1="301" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <line y2="477.05294" x2="571" y1="137" x1="571" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <line y2="478.05294" x2="29" y1="138" x1="29" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <line y2="553.05294" x2="125" y1="213" x1="125" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <line y2="557.05294" x2="472" y1="217" x1="472" stroke-width="46" stroke="currentColor" fill="none"/>\r\n            </svg>\r\n        </div>\r\n        <div class="snow-editor__shape" title="Квадрат" data-shape="rect">\r\n            <svg width="20" height="20" viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">\r\n                <rect height="503" width="503" y="46" x="49" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <line y2="537.23143" x2="296" y1="51" x1="296" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <line y2="535.23143" x2="169" y1="49" x1="169" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <line y2="541.23143" x2="426" y1="55" x1="426" stroke-width="46" stroke="currentColor" fill="none"/>\r\n            </svg>\r\n        </div>\r\n        <div class="snow-editor__shape" title="Конус" data-shape="cone">\r\n            <svg width="20" height="20" viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">\r\n                <path stroke="currentColor" d="m293,68.00001c-118,227 -256,496.99999 -256,496.99999c0,0 525,0 525,0c0,0 -140,-266.99999 -269,-496.99999z" stroke-width="46" fill="none"/>\r\n                <path d="m93,458l415.06447,0" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <line y2="342" x2="435.83328" y1="342" x1="166" stroke-width="46" stroke="currentColor" fill="none"/>\r\n                <line y2="231" x2="372.76906" y1="231" x1="217" stroke-width="46" stroke="currentColor" fill="none"/>\r\n            </svg>\r\n        </div>\r\n        <div class="snow-editor__button-free"></div>\r\n        <div class="snow-editor__size" data-value="2">1x</div>\r\n        <div class="snow-editor__size" data-value="4">2x</div>\r\n        <div class="snow-editor__size" data-value="7">3x</div>\r\n        <div class="snow-editor__size" data-value="9">4x</div>\r\n    </div>\r\n    <div class="snow-editor__canvas"></div>\r\n    <div class="snow-editor__colors">\r\n        <div class="snow-editor-color" data-value="1"></div>\r\n        <div class="snow-editor-color" data-value="11"></div>\r\n        <div class="snow-editor-color" data-value="2"></div>\r\n        <div class="snow-editor-color" data-value="3"></div>\r\n        <div class="snow-editor-color" data-value="12"></div>\r\n        <div class="snow-editor-color" data-value="4"></div>\r\n        <div class="snow-editor-color" data-value="5"></div>\r\n        <div class="snow-editor-color" data-value="6"></div>\r\n        <div class="snow-editor-color" data-value="7"></div>\r\n        <div class="snow-editor-color" data-value="8"></div>\r\n        <div class="snow-editor-color" data-value="9"></div>\r\n        <div class="snow-editor-color" data-value="10"></div>\r\n    </div>\r\n    <div class="snow-editor__props">\r\n'+(null!=(n=u(r,"each").call(a,null!=e?u(e,"props"):e,{name:"each",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i,loc:{start:{line:107,column:8},end:{line:109,column:17}}}))?n:"")+'    </div>\r\n    <div class="snow-editor__message snow-editor__message_error" data-group="save" hidden>\r\n        Что-то поломалось и мы не можем сохранить вашу работу. Попробуйте повторить сохранение чуть позже.\r\n    </div>\r\n    <div class="snow-editor__message snow-editor__message_success" data-group="save" hidden>\r\n        Успешно сохранено! В течение пары минут ваш снеговик появится в вашем профиле\r\n        <a href="https://pikabu.ru/@'+h(typeof(s=null!=(s=u(r,"userName")||(null!=e?u(e,"userName"):e))?s:l)===c?s.call(a,{name:"userName",hash:{},data:i,loc:{start:{line:116,column:36},end:{line:116,column:48}}}):s)+'" style="color: var(--color-bright-900)" target="_blank">https://pikabu.ru/@'+h(typeof(s=null!=(s=u(r,"userName")||(null!=e?u(e,"userName"):e))?s:l)===c?s.call(a,{name:"userName",hash:{},data:i,loc:{start:{line:116,column:124},end:{line:116,column:136}}}):s)+'</a>\r\n    </div>\r\n    <div class="snow-editor__message snow-editor__message_warning">\r\n        Для сохранения работы вам необходимо авторизоваться на Пикабу\r\n    </div>\r\n    <div class="snow-editor__save">\r\n        <button class="button button_success" data-role="save" type="button">Опубликовать в профиль</button>\r\n        <span>сохраняем...</span>\r\n    </div>\r\n\r\n    <div class="snow-editor__message snow-editor__message_error" data-group="destroy" hidden>\r\n        Что-то поломалось и мы не можем удалить снеговика из вашего профиля. Попробуйте повторить запрос чуть позже.\r\n    </div>\r\n    <div class="snow-editor__message snow-editor__message_success" data-group="destroy" hidden>\r\n        Успешно удалено из профиля!\r\n    </div>\r\n    <div class="snow-editor__destroy">\r\n        <button class="button button_danger" data-role="destroy" type="button">Удалить из профиля</button>\r\n        <span>применяем...</span>\r\n    </div>\r\n</div>'},useData:!0})},834:(t,e,r)=>{"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}e.__esModule=!0;var n=i(r(67)),s=o(r(558)),a=o(r(728)),l=i(r(392)),c=i(r(628)),h=o(r(936));function u(){var t=new n.HandlebarsEnvironment;return l.extend(t,n),t.SafeString=s.default,t.Exception=a.default,t.Utils=l,t.escapeExpression=l.escapeExpression,t.VM=c,t.template=function(e){return c.template(e,t)},t}var d=u();d.create=u,h.default(d),d.default=d,e.default=d,t.exports=e.default},67:(t,e,r)=>{"use strict";function o(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0,e.HandlebarsEnvironment=u;var i=r(392),n=o(r(728)),s=r(638),a=r(881),l=o(r(37)),c=r(293);e.VERSION="4.7.7",e.COMPILER_REVISION=8,e.LAST_COMPATIBLE_COMPILER_REVISION=7,e.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};var h="[object Object]";function u(t,e,r){this.helpers=t||{},this.partials=e||{},this.decorators=r||{},s.registerDefaultHelpers(this),a.registerDefaultDecorators(this)}u.prototype={constructor:u,logger:l.default,log:l.default.log,registerHelper:function(t,e){if(i.toString.call(t)===h){if(e)throw new n.default("Arg not supported with multiple helpers");i.extend(this.helpers,t)}else this.helpers[t]=e},unregisterHelper:function(t){delete this.helpers[t]},registerPartial:function(t,e){if(i.toString.call(t)===h)i.extend(this.partials,t);else{if(void 0===e)throw new n.default('Attempting to register a partial called "'+t+'" as undefined');this.partials[t]=e}},unregisterPartial:function(t){delete this.partials[t]},registerDecorator:function(t,e){if(i.toString.call(t)===h){if(e)throw new n.default("Arg not supported with multiple decorators");i.extend(this.decorators,t)}else this.decorators[t]=e},unregisterDecorator:function(t){delete this.decorators[t]},resetLoggedPropertyAccesses:function(){c.resetLoggedProperties()}};var d=l.default.log;e.log=d,e.createFrame=i.createFrame,e.logger=l.default},881:(t,e,r)=>{"use strict";e.__esModule=!0,e.registerDefaultDecorators=function(t){i.default(t)};var o,i=(o=r(670))&&o.__esModule?o:{default:o}},670:(t,e,r)=>{"use strict";e.__esModule=!0;var o=r(392);e.default=function(t){t.registerDecorator("inline",(function(t,e,r,i){var n=t;return e.partials||(e.partials={},n=function(i,n){var s=r.partials;r.partials=o.extend({},s,e.partials);var a=t(i,n);return r.partials=s,a}),e.partials[i.args[0]]=i.fn,n}))},t.exports=e.default},728:(t,e)=>{"use strict";e.__esModule=!0;var r=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function o(t,e){var i=e&&e.loc,n=void 0,s=void 0,a=void 0,l=void 0;i&&(n=i.start.line,s=i.end.line,a=i.start.column,l=i.end.column,t+=" - "+n+":"+a);for(var c=Error.prototype.constructor.call(this,t),h=0;h<r.length;h++)this[r[h]]=c[r[h]];Error.captureStackTrace&&Error.captureStackTrace(this,o);try{i&&(this.lineNumber=n,this.endLineNumber=s,Object.defineProperty?(Object.defineProperty(this,"column",{value:a,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:l,enumerable:!0})):(this.column=a,this.endColumn=l))}catch(t){}}o.prototype=new Error,e.default=o,t.exports=e.default},638:(t,e,r)=>{"use strict";function o(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0,e.registerDefaultHelpers=function(t){i.default(t),n.default(t),s.default(t),a.default(t),l.default(t),c.default(t),h.default(t)},e.moveHelperToHooks=function(t,e,r){t.helpers[e]&&(t.hooks[e]=t.helpers[e],r||delete t.helpers[e])};var i=o(r(342)),n=o(r(822)),s=o(r(905)),a=o(r(405)),l=o(r(702)),c=o(r(593)),h=o(r(978))},342:(t,e,r)=>{"use strict";e.__esModule=!0;var o=r(392);e.default=function(t){t.registerHelper("blockHelperMissing",(function(e,r){var i=r.inverse,n=r.fn;if(!0===e)return n(this);if(!1===e||null==e)return i(this);if(o.isArray(e))return e.length>0?(r.ids&&(r.ids=[r.name]),t.helpers.each(e,r)):i(this);if(r.data&&r.ids){var s=o.createFrame(r.data);s.contextPath=o.appendContextPath(r.data.contextPath,r.name),r={data:s}}return n(e,r)}))},t.exports=e.default},822:(t,e,r)=>{"use strict";e.__esModule=!0;var o,i=r(392),n=(o=r(728))&&o.__esModule?o:{default:o};e.default=function(t){t.registerHelper("each",(function(t,e){if(!e)throw new n.default("Must pass iterator to #each");var o,s=e.fn,a=e.inverse,l=0,c="",h=void 0,u=void 0;function d(e,r,o){h&&(h.key=e,h.index=r,h.first=0===r,h.last=!!o,u&&(h.contextPath=u+e)),c+=s(t[e],{data:h,blockParams:i.blockParams([t[e],e],[u+e,null])})}if(e.data&&e.ids&&(u=i.appendContextPath(e.data.contextPath,e.ids[0])+"."),i.isFunction(t)&&(t=t.call(this)),e.data&&(h=i.createFrame(e.data)),t&&"object"==typeof t)if(i.isArray(t))for(var p=t.length;l<p;l++)l in t&&d(l,l,l===t.length-1);else if(r.g.Symbol&&t[r.g.Symbol.iterator]){for(var f=[],v=t[r.g.Symbol.iterator](),m=v.next();!m.done;m=v.next())f.push(m.value);for(p=(t=f).length;l<p;l++)d(l,l,l===t.length-1)}else o=void 0,Object.keys(t).forEach((function(t){void 0!==o&&d(o,l-1),o=t,l++})),void 0!==o&&d(o,l-1,!0);return 0===l&&(c=a(this)),c}))},t.exports=e.default},905:(t,e,r)=>{"use strict";e.__esModule=!0;var o,i=(o=r(728))&&o.__esModule?o:{default:o};e.default=function(t){t.registerHelper("helperMissing",(function(){if(1!==arguments.length)throw new i.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}))},t.exports=e.default},405:(t,e,r)=>{"use strict";e.__esModule=!0;var o,i=r(392),n=(o=r(728))&&o.__esModule?o:{default:o};e.default=function(t){t.registerHelper("if",(function(t,e){if(2!=arguments.length)throw new n.default("#if requires exactly one argument");return i.isFunction(t)&&(t=t.call(this)),!e.hash.includeZero&&!t||i.isEmpty(t)?e.inverse(this):e.fn(this)})),t.registerHelper("unless",(function(e,r){if(2!=arguments.length)throw new n.default("#unless requires exactly one argument");return t.helpers.if.call(this,e,{fn:r.inverse,inverse:r.fn,hash:r.hash})}))},t.exports=e.default},702:(t,e)=>{"use strict";e.__esModule=!0,e.default=function(t){t.registerHelper("log",(function(){for(var e=[void 0],r=arguments[arguments.length-1],o=0;o<arguments.length-1;o++)e.push(arguments[o]);var i=1;null!=r.hash.level?i=r.hash.level:r.data&&null!=r.data.level&&(i=r.data.level),e[0]=i,t.log.apply(t,e)}))},t.exports=e.default},593:(t,e)=>{"use strict";e.__esModule=!0,e.default=function(t){t.registerHelper("lookup",(function(t,e,r){return t?r.lookupProperty(t,e):t}))},t.exports=e.default},978:(t,e,r)=>{"use strict";e.__esModule=!0;var o,i=r(392),n=(o=r(728))&&o.__esModule?o:{default:o};e.default=function(t){t.registerHelper("with",(function(t,e){if(2!=arguments.length)throw new n.default("#with requires exactly one argument");i.isFunction(t)&&(t=t.call(this));var r=e.fn;if(i.isEmpty(t))return e.inverse(this);var o=e.data;return e.data&&e.ids&&((o=i.createFrame(e.data)).contextPath=i.appendContextPath(e.data.contextPath,e.ids[0])),r(t,{data:o,blockParams:i.blockParams([t],[o&&o.contextPath])})}))},t.exports=e.default},572:(t,e,r)=>{"use strict";e.__esModule=!0,e.createNewLookupObject=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return o.extend.apply(void 0,[Object.create(null)].concat(e))};var o=r(392)},293:(t,e,r)=>{"use strict";e.__esModule=!0,e.createProtoAccessControl=function(t){var e=Object.create(null);e.constructor=!1,e.__defineGetter__=!1,e.__defineSetter__=!1,e.__lookupGetter__=!1;var r=Object.create(null);return r.__proto__=!1,{properties:{whitelist:o.createNewLookupObject(r,t.allowedProtoProperties),defaultValue:t.allowProtoPropertiesByDefault},methods:{whitelist:o.createNewLookupObject(e,t.allowedProtoMethods),defaultValue:t.allowProtoMethodsByDefault}}},e.resultIsAllowed=function(t,e,r){return function(t,e){return void 0!==t.whitelist[e]?!0===t.whitelist[e]:void 0!==t.defaultValue?t.defaultValue:(function(t){!0!==n[t]&&(n[t]=!0,i.log("error",'Handlebars: Access has been denied to resolve the property "'+t+'" because it is not an "own property" of its parent.\nYou can add a runtime option to disable the check or this warning:\nSee https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details'))}(e),!1)}("function"==typeof t?e.methods:e.properties,r)},e.resetLoggedProperties=function(){Object.keys(n).forEach((function(t){delete n[t]}))};var o=r(572),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(37)),n=Object.create(null)},5:(t,e)=>{"use strict";e.__esModule=!0,e.wrapHelper=function(t,e){return"function"!=typeof t?t:function(){return arguments[arguments.length-1]=e(arguments[arguments.length-1]),t.apply(this,arguments)}}},37:(t,e,r)=>{"use strict";e.__esModule=!0;var o=r(392),i={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(t){if("string"==typeof t){var e=o.indexOf(i.methodMap,t.toLowerCase());t=e>=0?e:parseInt(t,10)}return t},log:function(t){if(t=i.lookupLevel(t),"undefined"!=typeof console&&i.lookupLevel(i.level)<=t){var e=i.methodMap[t];console[e]||(e="log");for(var r=arguments.length,o=Array(r>1?r-1:0),n=1;n<r;n++)o[n-1]=arguments[n];console[e].apply(console,o)}}};e.default=i,t.exports=e.default},936:(t,e,r)=>{"use strict";e.__esModule=!0,e.default=function(t){var e=void 0!==r.g?r.g:window,o=e.Handlebars;t.noConflict=function(){return e.Handlebars===t&&(e.Handlebars=o),t}},t.exports=e.default},628:(t,e,r)=>{"use strict";e.__esModule=!0,e.checkRevision=function(t){var e=t&&t[0]||1,r=s.COMPILER_REVISION;if(!(e>=s.LAST_COMPATIBLE_COMPILER_REVISION&&e<=s.COMPILER_REVISION)){if(e<s.LAST_COMPATIBLE_COMPILER_REVISION){var o=s.REVISION_CHANGES[r],i=s.REVISION_CHANGES[e];throw new n.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+o+") or downgrade your runtime to an older version ("+i+").")}throw new n.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+t[1]+").")}},e.template=function(t,e){if(!e)throw new n.default("No environment passed to template");if(!t||!t.main)throw new n.default("Unknown template object: "+typeof t);t.main.decorator=t.main_d,e.VM.checkRevision(t.compiler);var r=t.compiler&&7===t.compiler[0],o={strict:function(t,e,r){if(!t||!(e in t))throw new n.default('"'+e+'" not defined in '+t,{loc:r});return o.lookupProperty(t,e)},lookupProperty:function(t,e){var r=t[e];return null==r||Object.prototype.hasOwnProperty.call(t,e)||c.resultIsAllowed(r,o.protoAccessControl,e)?r:void 0},lookup:function(t,e){for(var r=t.length,i=0;i<r;i++)if(null!=(t[i]&&o.lookupProperty(t[i],e)))return t[i][e]},lambda:function(t,e){return"function"==typeof t?t.call(e):t},escapeExpression:i.escapeExpression,invokePartial:function(r,o,s){s.hash&&(o=i.extend({},o,s.hash),s.ids&&(s.ids[0]=!0)),r=e.VM.resolvePartial.call(this,r,o,s);var a=i.extend({},s,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),l=e.VM.invokePartial.call(this,r,o,a);if(null==l&&e.compile&&(s.partials[s.name]=e.compile(r,t.compilerOptions,e),l=s.partials[s.name](o,a)),null!=l){if(s.indent){for(var c=l.split("\n"),h=0,u=c.length;h<u&&(c[h]||h+1!==u);h++)c[h]=s.indent+c[h];l=c.join("\n")}return l}throw new n.default("The partial "+s.name+" could not be compiled when running in runtime-only mode")},fn:function(e){var r=t[e];return r.decorator=t[e+"_d"],r},programs:[],program:function(t,e,r,o,i){var n=this.programs[t],s=this.fn(t);return e||i||o||r?n=h(this,t,s,e,r,o,i):n||(n=this.programs[t]=h(this,t,s)),n},data:function(t,e){for(;t&&e--;)t=t._parent;return t},mergeIfNeeded:function(t,e){var r=t||e;return t&&e&&t!==e&&(r=i.extend({},e,t)),r},nullContext:Object.seal({}),noop:e.VM.noop,compilerInfo:t.compiler};function s(e){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=r.data;s._setup(r),!r.partial&&t.useData&&(i=d(e,i));var n=void 0,a=t.useBlockParams?[]:void 0;function l(e){return""+t.main(o,e,o.helpers,o.partials,i,a,n)}return t.useDepths&&(n=r.depths?e!=r.depths[0]?[e].concat(r.depths):r.depths:[e]),(l=p(t.main,l,o,r.depths||[],i,a))(e,r)}return s.isTop=!0,s._setup=function(n){if(n.partial)o.protoAccessControl=n.protoAccessControl,o.helpers=n.helpers,o.partials=n.partials,o.decorators=n.decorators,o.hooks=n.hooks;else{var s=i.extend({},e.helpers,n.helpers);!function(t,e){Object.keys(t).forEach((function(r){var o=t[r];t[r]=function(t,e){var r=e.lookupProperty;return l.wrapHelper(t,(function(t){return i.extend({lookupProperty:r},t)}))}(o,e)}))}(s,o),o.helpers=s,t.usePartial&&(o.partials=o.mergeIfNeeded(n.partials,e.partials)),(t.usePartial||t.useDecorators)&&(o.decorators=i.extend({},e.decorators,n.decorators)),o.hooks={},o.protoAccessControl=c.createProtoAccessControl(n);var h=n.allowCallsToHelperMissing||r;a.moveHelperToHooks(o,"helperMissing",h),a.moveHelperToHooks(o,"blockHelperMissing",h)}},s._child=function(e,r,i,s){if(t.useBlockParams&&!i)throw new n.default("must pass block params");if(t.useDepths&&!s)throw new n.default("must pass parent depths");return h(o,e,t[e],r,0,i,s)},s},e.wrapProgram=h,e.resolvePartial=function(t,e,r){return t?t.call||r.name||(r.name=t,t=r.partials[t]):t="@partial-block"===r.name?r.data["partial-block"]:r.partials[r.name],t},e.invokePartial=function(t,e,r){var o=r.data&&r.data["partial-block"];r.partial=!0,r.ids&&(r.data.contextPath=r.ids[0]||r.data.contextPath);var a=void 0;if(r.fn&&r.fn!==u&&function(){r.data=s.createFrame(r.data);var t=r.fn;a=r.data["partial-block"]=function(e){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return r.data=s.createFrame(r.data),r.data["partial-block"]=o,t(e,r)},t.partials&&(r.partials=i.extend({},r.partials,t.partials))}(),void 0===t&&a&&(t=a),void 0===t)throw new n.default("The partial "+r.name+" could not be found");if(t instanceof Function)return t(e,r)},e.noop=u;var o,i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(392)),n=(o=r(728))&&o.__esModule?o:{default:o},s=r(67),a=r(638),l=r(5),c=r(293);function h(t,e,r,o,i,n,s){function a(e){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=s;return!s||e==s[0]||e===t.nullContext&&null===s[0]||(a=[e].concat(s)),r(t,e,t.helpers,t.partials,i.data||o,n&&[i.blockParams].concat(n),a)}return(a=p(r,a,t,s,o,n)).program=e,a.depth=s?s.length:0,a.blockParams=i||0,a}function u(){return""}function d(t,e){return e&&"root"in e||((e=e?s.createFrame(e):{}).root=t),e}function p(t,e,r,o,n,s){if(t.decorator){var a={};e=t.decorator(e,a,r,o&&o[0],n,s,o),i.extend(e,a)}return e}},558:(t,e)=>{"use strict";function r(t){this.string=t}e.__esModule=!0,r.prototype.toString=r.prototype.toHTML=function(){return""+this.string},e.default=r,t.exports=e.default},392:(t,e)=>{"use strict";e.__esModule=!0,e.extend=s,e.indexOf=function(t,e){for(var r=0,o=t.length;r<o;r++)if(t[r]===e)return r;return-1},e.escapeExpression=function(t){if("string"!=typeof t){if(t&&t.toHTML)return t.toHTML();if(null==t)return"";if(!t)return t+"";t=""+t}return i.test(t)?t.replace(o,n):t},e.isEmpty=function(t){return!t&&0!==t||!(!c(t)||0!==t.length)},e.createFrame=function(t){var e=s({},t);return e._parent=t,e},e.blockParams=function(t,e){return t.path=e,t},e.appendContextPath=function(t,e){return(t?t+".":"")+e};var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},o=/[&<>"'`=]/g,i=/[&<>"'`=]/;function n(t){return r[t]}function s(t){for(var e=1;e<arguments.length;e++)for(var r in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],r)&&(t[r]=arguments[e][r]);return t}var a=Object.prototype.toString;e.toString=a;var l=function(t){return"function"==typeof t};l(/x/)&&(e.isFunction=l=function(t){return"function"==typeof t&&"[object Function]"===a.call(t)}),e.isFunction=l;var c=Array.isArray||function(t){return!(!t||"object"!=typeof t)&&"[object Array]"===a.call(t)};e.isArray=c},202:(t,e,r)=>{t.exports=r(834).default}},e={};function r(o){var i=e[o];if(void 0!==i)return i.exports;var n=e[o]={exports:{}};return t[o](n,n.exports,r),n.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var o in e)r.o(e,o)&&!r.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=function(t,e,r,o){this.cell=t,this.x=e,this.y=r,this.z=o};function e(t,e,r){return 0===(t=t>1?1:t<0?0:t)?r:1===t?e:[Math.max(0,Math.min(255,r[0]+(e[0]-r[0])*t)),Math.max(0,Math.min(255,r[1]+(e[1]-r[1])*t)),Math.max(0,Math.min(255,r[2]+(e[2]-r[2])*t)),Math.max(0,Math.min(255,r[3]+(e[3]-r[3])*t))]}function o(t){return"#"+((255&t[0])<<16|(255&t[1])<<8|255&t[2]).toString(16).padStart(6,"0")}function i(t){var e=parseInt(t.substring(1),16);return[e>>16&255,e>>8&255,255&e,255]}function n(t,e){if(e[3]<20)return t.slice();if(t[3]<20)return e.slice();var r=e[0]/255,o=e[1]/255,i=e[2]/255,n=e[3]/255,s=t[0]/255,a=t[1]/255,l=t[2]/255,c=t[3]/255,h=(1-c)*n,u=h+c,d=(h*r+c*s)/u,p=(h*o+c*a)/u,f=(h*i+c*l)/u;return[Math.max(0,Math.min(255,255*d|0)),Math.max(0,Math.min(255,255*p|0)),Math.max(0,Math.min(255,255*f|0)),Math.max(0,Math.min(255,255*u|0))]}var s,a=i("#ffffff"),l=i("#9fb8c9"),c=i("#eef6fc"),h=i("#a7c1d3"),u=[[i("#ff0000"),i("#aa0000")],[i("#fdf63c"),i("#c5c719")],[a,l],[i("#5cff41"),i("#32c719")],[i("#5dd7ff"),i("#259cc3")],[i("#5f7dff"),i("#2542be")],[i("#a155ff"),i("#5c0ebc")],[i("#ff4af9"),i("#c10abb")],[i("#ff538c"),i("#c21a51")],[i("#505050"),i("#272727")],[i("#ffae00"),i("#c78c19")],[i("#b1ff6c"),i("#73be30")]],d="#99EE99",p="#CC5555",f=Math.max(15,10),v=function(){function e(t,e,r){this.cols=t,this.rows=e,this.levels=r,this.fillMapYX=null,this.fillMapY=null,this.renderList=null,this.changedCube={x1:0,x2:0,y1:0,y2:0,z1:0,z2:0},this.cellSize=8,this.cellSizeHalf=4,this.matrix=this.getEmptyMatrix(),this.setInitialChangedCube()}return e.prototype.getElementsCount=function(){for(var t=0,e=0;e<this.matrix.length;e++)for(var r=this.matrix[e],o=0;o<r.length;o++)for(var i=r[o],n=0;n<i.length;n++)null!==i[n]&&t++;return t},e.prototype.getZForNearestItem=function(t,e){if(e<0||t<0||e>=this.rows||t>=this.cols)return null;for(var r=0;r<this.levels;r++)if(null!==this.matrix[e][t][r])return r;return null},e.prototype.getMatrixXYByClientXY=function(t,e){return{x:Math.floor(t/this.cellSize),y:Math.floor(e/this.cellSize)}},e.prototype.getFillMapYX=function(){return null===this.fillMapYX&&this.calcFillMap(),this.fillMapYX},e.prototype.getFillMapY=function(){return null===this.fillMapY&&this.calcFillMap(),this.fillMapY},e.prototype.resetCache=function(){this.renderList=null,this.fillMapY=null,this.fillMapYX=null},e.prototype.setInitialChangedCube=function(){this.changedCube.x1=0,this.changedCube.x2=this.cols-1,this.changedCube.y1=0,this.changedCube.y2=this.rows-1,this.changedCube.z1=0,this.changedCube.z2=this.levels-1},e.prototype.mergeChangedCube=function(t){this.changedCube.x1=Math.min(this.changedCube.x1,t.x1),this.changedCube.x2=Math.max(this.changedCube.x2,t.x2),this.changedCube.y1=Math.min(this.changedCube.y1,t.y1),this.changedCube.y2=Math.max(this.changedCube.y2,t.y2),this.changedCube.z1=Math.min(this.changedCube.z1,t.z1),this.changedCube.z2=Math.max(this.changedCube.z2,t.z2)},e.prototype.getChangedCubeWithRenderIndent=function(){return{x1:Math.max(0,this.changedCube.x1-f),x2:Math.min(this.cols-1,this.changedCube.x2+f),y1:Math.max(0,this.changedCube.y1-f),y2:Math.min(this.rows-1,this.changedCube.y2+f),z1:Math.max(0,this.changedCube.z1-f),z2:Math.min(this.levels-1,this.changedCube.z2+f)}},e.prototype.hasChangedArea=function(){return this.changedCube.x1!==this.cols||this.changedCube.y1!==this.rows||this.changedCube.z1!==this.levels||0!==this.changedCube.x2||0!==this.changedCube.y2||0!==this.changedCube.z2},e.prototype.resetChangedArea=function(){this.changedCube.x1=this.cols,this.changedCube.y1=this.rows,this.changedCube.z1=this.levels,this.changedCube.x2=0,this.changedCube.y2=0,this.changedCube.z2=0},e.prototype.getRenderList=function(){if(null!==this.renderList)return this.renderList;var e=this.getFillMapY(),r=this.getFillMapYX();this.renderList=[];for(var o=0;o<this.rows;o++)if(!1!==e[o])for(var i=r[o],n=0;n<this.cols;n++)if(!1!==i[n])for(var s=this.matrix[o][n],a=0;a<this.levels;a++)if(null!==s[a]){this.renderList.push(new t(s[a],n,o,a));break}return this.renderList},e.prototype.clear=function(){this.matrix=this.getEmptyMatrix(),this.resetCache(),this.setInitialChangedCube()},e.prototype.calcFillMap=function(){var t=this;this.fillMapYX=new Array(this.rows).fill(null).map((function(){return new Array(t.cols).fill(!1)})),this.fillMapY=new Array(this.rows).fill(!1);for(var e=0;e<this.matrix.length;e++)for(var r=this.matrix[e],o=0;o<r.length;o++)for(var i=r[o],n=0;n<i.length;n++)if(null!==i[n]){this.fillMapYX[e][o]=!0,this.fillMapY[e]=!0;break}},e.prototype.getEmptyMatrix=function(){var t=this;return new Array(this.rows).fill(null).map((function(){return new Array(t.cols).fill(null).map((function(){return new Array(t.levels).fill(null)}))}))},e}(),m=function(){function t(t){this.matrix=t}return t.prototype.calc=function(){for(var t=this.matrix.matrix,e=this.matrix.getFillMapYX(),r=this.matrix.getFillMapY(),o=this.matrix.getChangedCubeWithRenderIndent(),i=o.y1;i<=o.y2;i++)if(!1!==r[i])for(var n=t[i],s=e[i],a=o.x1;a<=o.x2;a++)if(!1!==s[a])for(var l=n[a],c=o.z1;c<=o.z2;c++)if(null!==l[c]){var h=l[c];if(this.checkFreeCellsAtTheTop(i,a,c)){h.lightness=1;break}for(var u=1,d=1,p=1;p<=4;p++)this.checkFreeCellsAtTheRight(i,a,c-p)||(u-=.25),this.checkFreeCellsAtTheTop(i,a,c-p)||(d-=.25);h.lightness=(u+d)/2*.9;break}},t.prototype.checkFreeCellsAtTheTop=function(t,e,r){if(r<0||t<0||e<0)return!0;for(var o=this.matrix.matrix,i=t-1,n=Math.max(0,t-15);i>=n;i--)if(null!==o[i][e][r])return!1;return!0},t.prototype.checkFreeCellsAtTheRight=function(t,e,r){if(r<0||t<0||e<0)return!0;for(var o=this.matrix.matrix,i=e+1,n=Math.min(89,e+10);i<=n;i++)if(null!==o[t][i][r])return!1;return!0},t}(),x=function(){function t(t){this.matrix=t}return t.prototype.calc=function(){for(var t=this.matrix.matrix,e=this.matrix.getFillMapYX(),r=this.matrix.getFillMapY(),o=t.length-1,i=this.matrix.getChangedCubeWithRenderIndent(),n=i.y1;n<=i.y2;n++)if(!1!==r[n])for(var s=t[n],a=e[n],l=i.x1;l<=i.x2;l++)if(!1!==a[l])for(var c=s[l],h=i.z1;h<=i.z2;h++)if(null!==c[h]){c[h].isDropShadow=0!==l&&!t[n][l-1][h]||0!==l&&n!==o&&!t[n+1][l-1][h]||n!==o&&!t[n+1][l][h];break}},t}(),y=function(){function t(t){this.matrix=t}return t.prototype.calc=function(){t.version=(t.version+1)%1e6,this.markGroundCells(),this.fillYRay(this.matrix.rows-2,-1)},t.prototype.markGroundCells=function(){for(var e=this.matrix.matrix[this.matrix.rows-1],r=0;r<this.matrix.cols;r++)for(var o=e[r],i=0;i<this.matrix.levels;i++){var n=o[i];null!==n&&(n.groundingVersion=t.version)}},t.prototype.fillYRay=function(e,r){for(var o=this.matrix.matrix,i=this.matrix.getFillMapY(),n=this.matrix.getFillMapYX(),s=e;s<this.matrix.rows&&s>=0&&i[s];s+=r){for(var a=o[s],l=n[s],c=0,h={yDirection:r,needChangeDirection:!1},u=0;u<this.matrix.cols;u++)if(l[u])for(var d=a[u],p=0;p<this.matrix.levels;p++){var f=d[p];if(null!==f&&f.groundingVersion!==t.version){var v=o[s+-r][u][p];v&&v.groundingVersion===t.version&&(f.groundingVersion=t.version,c++,c+=this.fillXRay(s,u+1,p,1,h),c+=this.fillXRay(s,u-1,p,-1,h))}}if(h.needChangeDirection&&this.fillYRay(s+-r,-r),0===c)break}},t.prototype.fillXRay=function(e,r,o,i,n){for(var s=this.matrix.matrix,a=this.matrix.getFillMapYX()[e],l=this.matrix.matrix[e],c=0,h=r;h<this.matrix.cols&&h>=0&&a[h];h+=i){var u=l[h][o];if(null===u||u.groundingVersion===t.version)break;if(u.groundingVersion=t.version,c++,!n.needChangeDirection){var d=s[e+-n.yDirection][h][o];d&&d.groundingVersion!==t.version&&(n.needChangeDirection=!0)}var p=l[h],f=p[o+1];f&&f.groundingVersion!==t.version&&(c+=this.fillZRay(e,r,o+1,1,n)),(f=p[o-1])&&f.groundingVersion!==t.version&&(c+=this.fillZRay(e,r,o-1,-1,n))}return c},t.prototype.fillZRay=function(e,r,o,i,n){for(var s,a,l=this.matrix.matrix,c=l[e],h=c[r],u=0,d=o;d<this.matrix.levels&&d>=0;d+=i){var p=h[d];if(null===p||p.groundingVersion===t.version)break;if(p.groundingVersion=t.version,u++,!n.needChangeDirection){var f=l[e+-n.yDirection][r][d];f&&f.groundingVersion!==t.version&&(n.needChangeDirection=!0)}var v=null===(s=c[r+1])||void 0===s?void 0:s[d];v&&v.groundingVersion!==t.version&&(u+=this.fillXRay(e,r+1,d,1,n)),(v=null===(a=c[r-1])||void 0===a?void 0:a[d])&&v.groundingVersion!==t.version&&(u+=this.fillXRay(e,r-1,d,-1,n))}return u},t.version=2,t}(),g=function(){function t(t,e){this.matrix=t,this.matrixTransform=e}return t.prototype.calc=function(){for(var t=!1,e=this.matrix.matrix,r=this.matrix.getFillMapYX(),o=this.matrix.getFillMapY(),i=this.matrix.rows-1,n=this.matrix.rows-2;n>=0;n--)if(o[n])for(var s=r[n],a=e[n],l=0;l<this.matrix.cols;l++)if(s[l])for(var c=a[l],h=0;h<this.matrix.levels;h++){var u=c[h];if(null!==u&&u.groundingVersion!==y.version){var d=Math.min(i,n+5);this.matrixTransform.setCell(d,l,h,u);for(var p=d-1;p>=n;p--)this.matrixTransform.setCell(p,l,h,null);t=!0}}return t&&this.matrix.resetCache(),t},t}(),w=function(){function t(t,e,r){void 0===e&&(e=null),void 0===r&&(r=null),this.matrix=t,this.history=e,this.props=r}return t.prototype.setCell=function(t,e,r,o){this.matrix.matrix[t][e][r]=o,this.updateChangedCube(e,t,r,o)},t.prototype.excludeNearest=function(t,e,r){for(var o=0,i=0;i<this.matrix.levels&&o<2;i++)this.exclude(t,e,r,i)>0&&o++;this.matrix.resetCache()},t.prototype.exclude=function(t,e,r,o){for(var i=this.matrix.matrix,n=t.matrix,s=e-(t.cols>>1),a=r-(t.rows>>1),l=o-(t.levels>>1),c=s+t.cols,h=a+t.rows,u=l+t.levels,d=0,p=a;p<h;p++)if(!(p>=this.matrix.rows||p<0))for(var f=s;f<c;f++)if(!(f>=this.matrix.cols||f<0))for(var v=l;v<u;v++)v>=this.matrix.levels||v<0||null!==n[p-a][f-s][v-l]&&null!==i[p][f][v]&&(this.updateChangedCube(f,p,v,i[p][f][v]),i[p][f][v]=null,d++);return d},t.prototype.merge=function(t,e,r,o){for(var i=this.matrix.matrix,n=t.matrix,s=0;s<t.rows;s++){var a=s+r;if(!(a>=this.matrix.rows||a<0))for(var l=0;l<t.cols;l++){var c=l+e;if(!(c>=this.matrix.cols||c<0))for(var h=0;h<t.levels;h++){var u=h+o;u>=this.matrix.levels||u<0||null!==n[s][l][h]&&(i[a][c][u]=n[s][l][h],this.updateChangedCube(c,a,u))}}}this.matrix.resetCache()},t.prototype.updateChangedCube=function(t,e,r,o){void 0===o&&(o=null);var i=this.matrix.changedCube;if(e<i.y1&&(i.y1=e),e>i.y2&&(i.y2=e),t<i.x1&&(i.x1=t),t>i.x2&&(i.x2=t),r<i.z1&&(i.z1=r),r>i.z2&&(i.z2=r),null!==o&&o.prop>0){var n=this.props.getPropByCode(o.prop);if(n){var s=n.naturalWidth>>1,a=n.naturalHeight>>1,l=t-Math.floor(s/this.matrix.cellSize),c=l+Math.ceil(s/this.matrix.cellSize),h=e-Math.floor(a/this.matrix.cellSize),u=h+Math.ceil(a/this.matrix.cellSize);this.updateChangedCube(l,h,r),this.updateChangedCube(c,u,r)}}},t}(),C=function(){function t(t,e,r){var o=this;this.matrix=t,this.matrixHistory=e,this.renderer=r,this.physicsCalcTimerId=0,this.needRender=!0,this.needResetChangedArea=!1,this.animationRequestId=0,this.render=function(){if(cancelAnimationFrame(o.animationRequestId),o.needRender){o.needRender=!1;var t=performance.now();o.renderer.renderItems(function(t,e,r){if(r||2===arguments.length)for(var o,i=0,n=e.length;i<n;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))}([],o.matrix.getRenderList(),!0)),console.log("render",performance.now()-t),o.animationRequestId=requestAnimationFrame(o.render),o.needResetChangedArea&&(o.matrix.resetChangedArea(),o.needResetChangedArea=!1)}else o.animationRequestId=requestAnimationFrame(o.render)};var i=new w(this.matrix,this.matrixHistory);this.dropShadowCalc=new x(this.matrix),this.lightnessCalc=new m(this.matrix),this.groupsCalc=new y(this.matrix),this.gravityCalc=new g(this.matrix,i),this.calcShadows(),this.render()}return t.prototype.requestRender=function(){this.calcShadows(),this.requestPhysicsCalc(20),this.needRender=!0},t.prototype.calcShadows=function(){var t=performance.now();this.dropShadowCalc.calc(),this.lightnessCalc.calc(),console.log("shadows",performance.now()-t),this.needRender=!0},t.prototype.calcPhysics=function(){var t=performance.now(),e=!1;this.groupsCalc.calc(),e||(e=this.gravityCalc.calc()),e&&this.requestPhysicsCalc(20),this.calcShadows(),this.needRender=!0,this.needResetChangedArea=!0,console.log("physics",performance.now()-t)},t.prototype.requestPhysicsCalc=function(t){clearTimeout(this.physicsCalcTimerId),this.physicsCalcTimerId=window.setTimeout(this.calcPhysics.bind(this),t)},t}(),b=2*Math.PI,_=function(){function t(t,e,r,o){void 0===o&&(o=!1),this.matrix=t,this.options=e,this.props=r,this.canvas=document.createElement("canvas"),this.canvas.width=this.matrix.cols*this.matrix.cellSize,this.canvas.height=this.matrix.rows*this.matrix.cellSize,o||(this.canvas.style.width="".concat(this.canvas.width/2,"px"),this.canvas.style.height="".concat(this.canvas.height/2,"px")),this.context=this.canvas.getContext("2d"),this.tempCanvas=document.createElement("canvas"),this.tempCanvas.width=this.canvas.width,this.tempCanvas.height=this.canvas.height,this.tempContext=this.tempCanvas.getContext("2d"),this.blurCanvas=document.createElement("canvas"),this.blurCanvas.width=this.tempCanvas.width,this.blurCanvas.height=this.tempCanvas.height,this.blurContext=this.blurCanvas.getContext("2d")}return t.prototype.renderItems=function(e){if(console.log("Render items: "+e.length),this.matrix.hasChangedArea()){var r=this.matrix,o=r.changedCube,i=Math.max(0,(o.x1-f)*r.cellSize),n=Math.max(0,(o.y1-f)*r.cellSize),s=Math.min(this.tempCanvas.width,(o.x2+f)*r.cellSize)-i,a=Math.min(this.tempCanvas.height,(o.y2+f)*r.cellSize)-n;e=this.filterRenderList(e);var l=t.splitOnLayers(e);this.tempContext.clearRect(0,0,this.tempCanvas.width,this.tempCanvas.height),this.tempContext.save();for(var c=40;c>=0;c--)0!==(h=l[c]).length&&this.renderCells(h);for(this.applyBlur(i,n,s,a),c=40;c>=0;c--){var h;0!==(h=l[c]).length&&this.renderProps(h)}this.tempContext.restore(),this.context.clearRect(i,n,s,a),this.context.drawImage(this.tempCanvas,i,n,s,a,i,n,s,a),this.options.showRenderAreas&&this.renderArea(i,n,s,a)}},t.prototype.applyBlur=function(t,e,r,o){this.blurContext.clearRect(t,e,r,o),this.blurContext.drawImage(this.tempCanvas,t,e,r,o,t,e,r,o),this.tempContext.save(),this.tempContext.filter="blur(".concat(2,"px)"),this.tempContext.globalCompositeOperation="source-atop",this.tempContext.drawImage(this.blurCanvas,t,e,r,o,t,e,r,o),this.tempContext.restore()},t.prototype.renderShadow=function(t){var e=this.matrix;this.tempContext.globalCompositeOperation="source-atop";for(var r=0;r<t.length;r++){var o=t[r];o.cell.isDropShadow&&(this.tempContext.save(),this.tempContext.translate(o.x*e.cellSize+e.cellSizeHalf,o.y*e.cellSize+e.cellSizeHalf),this.renderCellShadow(o.cell),this.tempContext.restore())}},t.prototype.renderCells=function(t){var e=this.matrix;this.tempContext.globalCompositeOperation="source-over";for(var r=0;r<t.length;r++){var o=t[r];this.tempContext.save(),this.tempContext.translate(o.x*e.cellSize+e.cellSizeHalf,o.y*e.cellSize+e.cellSizeHalf),this.renderCell(o.cell),this.tempContext.restore()}},t.prototype.renderProps=function(t){var e=this.matrix;this.tempContext.globalCompositeOperation="source-over";for(var r=0;r<t.length;r++){var o=t[r];o.cell.prop&&(this.tempContext.save(),this.tempContext.translate(o.x*e.cellSize+e.cellSizeHalf,o.y*e.cellSize+e.cellSizeHalf),this.renderCellProps(o.cell),this.tempContext.restore())}},t.prototype.renderArea=function(t,e,r,o){this.context.save(),this.context.beginPath(),this.context.strokeStyle="#ff00ff",this.context.rect(t,e,r,o),this.context.closePath(),this.context.stroke(),this.context.restore()},t.prototype.filterRenderList=function(t){var e=this,r=this.matrix.changedCube,o=f<<1,i=r.x1-o,n=r.x2+o,s=r.y1-o,a=r.y2+o;return t.filter((function(t){if(t.cell.prop>0){var r=e.props.getPropByCode(t.cell.prop);if(r){var o=r.naturalWidth>>1,l=r.naturalHeight>>1,c=t.x-Math.floor(o/e.matrix.cellSize),h=c+Math.ceil(o/e.matrix.cellSize),u=t.y-Math.floor(l/e.matrix.cellSize),d=u+Math.ceil(l/e.matrix.cellSize);if(c<=n&&h>=i&&u<=a&&d>=s)return!0}}return t.x>=i&&t.x<=n&&t.y>=s&&t.y<=a}))},t.splitOnLayers=function(t){for(var e=new Array(41).fill(null).map((function(){return[]})),r=0,o=t;r<o.length;r++){var i=o[r];e[i.z].push(i)}return e},t.prototype.renderCell=function(t){var r=e(t.lightness-t.darkness,a,l);null!==t.colorLight&&null!==t.colorDark&&(r=n(e(t.lightness-t.darkness,t.colorLight,t.colorDark),r)),this.tempContext.fillStyle=o(r),this.tempContext.beginPath(),this.tempContext.arc(0,0,12+t.extraRadius,0,b),this.tempContext.closePath(),this.tempContext.fill()},t.prototype.renderCellShadow=function(t){if(t.isDropShadow){var r=12+t.extraRadius,i=.4*r,s=e(t.lightness-t.darkness,c,h);null!==t.colorLight&&null!==t.colorDark&&(s=n(e(t.lightness-t.darkness,t.colorLight,t.colorDark),s)),this.tempContext.fillStyle=o(s),this.tempContext.beginPath(),this.tempContext.arc(-i,i,1.2*r,0,b),this.tempContext.closePath(),this.tempContext.fill()}},t.prototype.renderCellProps=function(t){if(t.prop){var e=this.props.getPropByCode(t.prop);if(e){var r=e.naturalWidth/1,o=e.naturalHeight/1;this.tempContext.drawImage(e,-Math.floor(r/2),-Math.floor(o/2),r,o)}}},t}(),M=2*Math.PI,S=function(){function t(t,e){this.matrix=e,this.canvas=document.createElement("canvas"),this.canvas.width=t.canvas.width,this.canvas.height=t.canvas.height,this.canvas.style.width="".concat(this.canvas.width/2,"px"),this.canvas.style.height="".concat(this.canvas.height/2,"px"),this.context=this.canvas.getContext("2d")}return t.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.drawCircle=function(t,e,r,o){t=this.correctPosition(t),e=this.correctPosition(e),this.clear(),this.context.save(),this.context.strokeStyle=o,this.context.lineWidth=2,this.context.beginPath(),this.context.arc(t,e,r,M,0),this.context.closePath(),this.context.stroke(),this.context.restore()},t.prototype.drawTriangle=function(t,e,r,o,i){t=this.correctPosition(t),e=this.correctPosition(e),this.clear(),this.context.save(),this.context.strokeStyle=i,this.context.lineWidth=2,this.context.beginPath(),this.context.moveTo(t+(r>>1),e),this.context.lineTo(t+r,e+o),this.context.lineTo(t,e+o),this.context.closePath(),this.context.stroke(),this.context.restore()},t.prototype.drawRect=function(t,e,r,o,i){t=this.correctPosition(t),e=this.correctPosition(e),this.clear(),this.context.save(),this.context.strokeStyle=i,this.context.lineWidth=2,this.context.beginPath(),this.context.rect(t,e,r,o),this.context.closePath(),this.context.stroke(),this.context.restore()},t.prototype.drawImage=function(t,e,r){t=this.correctPosition(t),e=this.correctPosition(e);var o=r.naturalWidth/1,i=r.naturalHeight/1;this.clear(),this.context.drawImage(r,t-Math.floor(o/2),e-Math.floor(i/2),o,i)},t.prototype.correctPosition=function(t){return Math.round(t/this.matrix.cellSize)*this.matrix.cellSize},t}(),k=function(t,e,r){if(r||2===arguments.length)for(var o,i=0,n=e.length;i<n;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},P=function(){function t(){this.hash="",this.extraRadius=0,this.lightness=1,this.darkness=0,this.isDropShadow=!1,this.prop=0,this.colorLight=null,this.colorDark=null,this.extraRadius=6*Math.random(),this.darkness=.1*Math.random(),this.groundingVersion=y.version,t.updateCellHash(this)}return t.updateCellHash=function(t){t.hash=k(k([1e3*t.extraRadius|0,100*t.darkness|0,t.prop],t.colorLight||[0,0,0,0],!0),t.colorDark||[0,0,0,0],!0).join(",")},t}(),z=function(){function t(){}return t.prototype.generateZAxis=function(t){for(var e=1+(t<<1),r=new v(e,e,1),o=t,i=null,n=null,s=90;s<270;s++){var a=s*Math.PI/180,l=Math.round(Math.cos(a)*t),c=Math.round(Math.sin(a)*-t);if(l!==i||c!==n){i=l,n=c;for(var h=l,u=Math.abs(l);h<u;h++)r.matrix[o+c][o+h][0]=new P}}return r},t.prototype.generateYAxis=function(t){for(var e=1+(t<<1),r=new v(e,1,e),o=t,i=null,n=null,s=90;s<270;s++){var a=s*Math.PI/180,l=Math.round(Math.cos(a)*t),c=Math.round(Math.sin(a)*-t);if(l!==i||c!==n){i=l,n=c;for(var h=l,u=Math.abs(l);h<u;h++)r.matrix[0][o+h][o+c]=new P}}return r},t}(),T=function(){function t(){this.reduceCellsFactor=0}return t.prototype.setReduceCellsFactor=function(t){return this.reduceCellsFactor=Math.max(0,Math.min(.7,t)),this},t.prototype.generate=function(t){for(var e=1+(t<<1),r=new v(e,e,e),o=new w(r),i=0;i<e;i++){var n=Math.PI*(i/(e-1)),s=Math.round(t*Math.sin(n));if(!(s<=0)){var a=(new z).generateZAxis(s);o.merge(a,t-(a.cols>>1),t-(a.rows>>1),i)}}return this.reduceCells(r),r},t.prototype.reduceCells=function(t){if(0!==this.reduceCellsFactor)for(var e=0;e<t.rows;e++)for(var r=t.matrix[e],o=0;o<t.cols;o++)for(var i=r[o],n=0;n<t.levels;n++)null!==i[n]&&Math.random()<this.reduceCellsFactor&&(i[n]=null)},t}(),E=function(){function t(t,e,r){this.matrix=t,this.matrixTransform=e,this.cursor=r,this.size=20,this.observer=null}return t.prototype.observe=function(t){this.observer=t},t.prototype.click=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e);var r=this.matrix.getMatrixXYByClientXY(t,e),o=r.x,i=r.y;this.addSphere(o,i)},t.prototype.move=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e),this.cursor.drawCircle(t,e,this.size*this.matrix.cellSize,d)},t.prototype.leave=function(){this.cursor.clear()},t.prototype.correctPosition=function(t){t*=2;var e=2*this.matrix.cellSize;return Math.round(t/e)*e},t.prototype.addSphere=function(t,e){this.matrixTransform.merge((new T).generate(this.size),t-this.size,e-this.size,20-this.size),null!==this.observer&&this.observer()},t}(),R=function(){function t(){}return t.prototype.generate=function(t){for(var e=new v(t,t,t),r=0;r<e.rows;r++)for(var o=e.matrix[r],i=0;i<e.cols;i++)for(var n=o[i],s=0;s<e.levels;s++)n[s]=new P;return e},t}(),A=function(){function t(t,e,r){this.matrix=t,this.matrixTransform=e,this.cursor=r,this.size=40,this.observer=null}return t.prototype.observe=function(t){this.observer=t},t.prototype.click=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e);var r=this.matrix.getMatrixXYByClientXY(t,e),o=r.x,i=r.y;this.addCube(o,i)},t.prototype.move=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e);var r=this.size*this.matrix.cellSize,o=r/2;this.cursor.drawRect(t-o,e-o,r,r,d)},t.prototype.leave=function(){this.cursor.clear()},t.prototype.correctPosition=function(t){t*=2;var e=2*this.matrix.cellSize;return Math.round(t/e)*e},t.prototype.addCube=function(e,r){var o=(new R).generate(this.size-1);t.roundCorners(o);var i=this.size/2;this.matrixTransform.merge(o,2*Math.round((e-i)/2),2*Math.round((r-i)/2),2*Math.round((20-i)/2)),null!==this.observer&&this.observer()},t.roundCorners=function(t){for(var e=t.rows-1,r=t.cols-1,o=t.levels-1,i=0;i<t.rows;i++)t.matrix[i][0][0]=null,t.matrix[i][0][o]=null,t.matrix[i][r][0]=null,t.matrix[i][r][o]=null;for(var n=0;n<t.cols;n++)t.matrix[0][n][0]=null,t.matrix[0][n][o]=null,t.matrix[e][n][0]=null,t.matrix[e][n][o]=null},t}(),I=function(){function t(t,e,r){this.matrix=t,this.matrixTransform=e,this.cursor=r,this.size=7,this.observer=null}return t.prototype.observe=function(t){this.observer=t},t.prototype.click=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e);var r=this.matrix.getMatrixXYByClientXY(t,e),o=r.x,i=r.y;this.excludeSphere(o,i)},t.prototype.move=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e),this.cursor.drawCircle(t,e,this.size*this.matrix.cellSize,p)},t.prototype.leave=function(){this.cursor.clear()},t.prototype.correctPosition=function(t){t*=2;var e=2*this.matrix.cellSize;return Math.round(t/e)*e},t.prototype.excludeSphere=function(t,e){this.matrixTransform.excludeNearest((new T).generate(this.size),t,e),null!==this.observer&&this.observer()},t}(),L=function(){function t(t,e,r,o){this.matrix=t,this.matrixHistory=e,this.cursor=r,this.props=o,this.img=null,this.code=0,this.observer=null}return t.prototype.setPropCode=function(t){this.code=t,this.img=this.props.getPropByCode(t)},t.prototype.observe=function(t){this.observer=t},t.prototype.click=function(t,e){var r;t=this.correctPosition(t),e=this.correctPosition(e);for(var o=this.matrix.getMatrixXYByClientXY(t,e),i=o.x,n=o.y,s=Math.ceil(this.img.naturalWidth/1/this.matrix.cellSize/2),a=Math.ceil(this.img.naturalHeight/1/this.matrix.cellSize/2),l=this.matrix.matrix[n][i],c=0;c<this.matrix.levels;c++)if(null!==l[c]){l[c].prop=this.code,P.updateCellHash(l[c]),this.matrix.mergeChangedCube({x1:i-s,x2:i+s,y1:n-a,y2:n+s,z1:c,z2:c}),null===(r=this.observer)||void 0===r||r.call(this);break}},t.prototype.move=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e),this.cursor.drawImage(t,e,this.img)},t.prototype.leave=function(){this.cursor.clear()},t.prototype.correctPosition=function(t){t*=2;var e=this.matrix.cellSize;return Math.round(t/e)*e},t}(),D=function(){function t(t){var e=this;this.el=t,this.touchX=0,this.touchY=0,this.startX=0,this.startY=0,this.maxDeltaX=0,this.maxDeltaY=0,this.touchId=0,this.handler=null,this.handleTouchStart=function(t){var r,o;if(0===e.touchId){var i=t.targetTouches[0];e.touchId=i.identifier,e.touchX=i.clientX,e.touchY=i.clientY,e.maxDeltaX=0,e.maxDeltaY=0;var n=e.el.getBoundingClientRect();e.startX=i.clientX-n.left,e.startY=i.clientY-n.top,null===(o=null===(r=e.handler)||void 0===r?void 0:r.start)||void 0===o||o.call(r,e.startX,e.startY)}},this.handleTouchMove=function(t){var r,o,i=e.getTouchById(t.targetTouches);if(i){var n=e.touchX-i.clientX,s=e.touchY-i.clientY;e.maxDeltaX=Math.max(n,e.maxDeltaX),e.maxDeltaY=Math.max(s,e.maxDeltaY),null===(o=null===(r=e.handler)||void 0===r?void 0:r.drag)||void 0===o||o.call(r,n,s,e.startX-n,e.startY-s)}},this.handleTouchEnd=function(t){var r,o,i,n;e.getTouchById(t.targetTouches)||(e.touchId=0,null===(o=null===(r=e.handler)||void 0===r?void 0:r.stop)||void 0===o||o.call(r)),e.maxDeltaX<4&&e.maxDeltaY<4&&(null===(n=null===(i=e.handler)||void 0===i?void 0:i.click)||void 0===n||n.call(i,e.startX-e.maxDeltaX,e.startY-e.maxDeltaY))},this.handleMouseDown=function(t){var r,o,i,n;e.touchX=t.clientX,e.touchY=t.clientY;var s=e.el.getBoundingClientRect();e.startX=t.clientX-s.left,e.startY=t.clientY-s.top,e.maxDeltaX=0,e.maxDeltaY=0,document.addEventListener("mousemove",e.handleMouseDrag,{capture:!0}),document.addEventListener("mouseup",e.handleMouseUp,{capture:!0}),null===(o=null===(r=e.handler)||void 0===r?void 0:r.start)||void 0===o||o.call(r,e.startX,e.startY),null===(n=null===(i=e.handler)||void 0===i?void 0:i.click)||void 0===n||n.call(i,e.startX,e.startY)},this.handleMouseDrag=function(t){var r,o,i=e.touchX-t.clientX,n=e.touchY-t.clientY;e.maxDeltaX=Math.max(i,e.maxDeltaX),e.maxDeltaY=Math.max(n,e.maxDeltaY),null===(o=null===(r=e.handler)||void 0===r?void 0:r.drag)||void 0===o||o.call(r,i,n,e.startX-i,e.startY-n)},this.handleMouseMove=function(t){var r,o,i=e.el.getBoundingClientRect(),n=t.clientX-i.left,s=t.clientY-i.top;e.maxDeltaX=Math.max(n,e.maxDeltaX),e.maxDeltaY=Math.max(s,e.maxDeltaY),null===(o=null===(r=e.handler)||void 0===r?void 0:r.move)||void 0===o||o.call(r,n,s)},this.handleMouseUp=function(){var t,r;document.removeEventListener("mousemove",e.handleMouseDrag,{capture:!0}),document.removeEventListener("mouseup",e.handleMouseUp,{capture:!0}),null===(r=null===(t=e.handler)||void 0===t?void 0:t.stop)||void 0===r||r.call(t)},this.handleMouseLeave=function(){var t,r;null===(r=null===(t=e.handler)||void 0===t?void 0:t.leave)||void 0===r||r.call(t)},this.assignPointerEvents()}return t.prototype.setHandler=function(t){this.handler=t},t.prototype.assignPointerEvents=function(){"ontouchstart"in document?(this.el.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),this.el.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),this.el.addEventListener("touchend",this.handleTouchEnd,{passive:!1})):(this.el.addEventListener("mousedown",this.handleMouseDown),this.el.addEventListener("mousemove",this.handleMouseMove),this.el.addEventListener("mouseleave",this.handleMouseLeave))},t.prototype.getTouchById=function(t){for(var e=0;e<t.length;e++)if(t[e].identifier===this.touchId)return t[e]},t}(),Y=function(){function t(t,e,r){this.matrix=t,this.matrixHistory=e,this.cursor=r,this.size=20,this.colorLight=null,this.colorDark=null,this.observer=null}return t.prototype.setColor=function(t,e){this.colorLight=t,this.colorDark=e},t.prototype.observe=function(t){this.observer=t},t.prototype.click=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e);var r=this.matrix.getMatrixXYByClientXY(t,e),o=r.x,i=r.y;this.paintCircle(o,i)},t.prototype.move=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e),this.cursor.drawCircle(t,e,this.size*this.matrix.cellSize,"#00AAFF")},t.prototype.leave=function(){this.cursor.clear()},t.prototype.paintCircle=function(e,r){if(null!==this.colorLight&&null!==this.colorDark){for(var o=Math.min(20,this.size),i=Math.max(0,r-o),s=Math.min(this.matrix.rows-1,r+o),a=Math.max(0,e-o),l=Math.min(this.matrix.cols-1,e+o),c=this.matrix.levels-1,h=0,u=this.matrix.matrix,d=i;d<=s;d++)for(var p=a;p<=l;p++){var f=this.matrix.getZForNearestItem(p,d);if(null!==f){var v=Math.sqrt(Math.pow(p-e,2)+Math.pow(d-r,2));if(!(v>o)){c=f<c?f:c,h=f>h?f:h;var m=128*(1-v/o)|0,x=u[d][p][f];P.updateCellHash(x);var y=t.copyColorWithNewAlpha(this.colorLight,m),g=t.copyColorWithNewAlpha(this.colorDark,m);null!==x.colorDark?(x.colorLight=n(y,x.colorLight),x.colorDark=n(g,x.colorDark)):(x.colorLight=y,x.colorDark=g)}}}this.matrix.mergeChangedCube({x1:a,x2:l,y1:i,y2:s,z1:c,z2:h}),null!==this.observer&&this.observer()}},t.prototype.correctPosition=function(t){t*=2;var e=2*this.matrix.cellSize;return Math.round(t/e)*e},t.copyColorWithNewAlpha=function(t,e){return[t[0],t[1],t[2],e]},t}(),H=function(){function t(){}return t.prototype.generateVertical=function(t,e){for(var r=1+(t<<1),o=new v(r,e,r),i=new w(o),n=0;n<e;n++)i.merge((new z).generateYAxis(t),0,n,0);return o},t.prototype.generateHorizontal=function(t,e){for(var r=1+(t<<1),o=new v(r,r,e),i=new w(o),n=0;n<e;n++)i.merge((new z).generateZAxis(t),0,0,n);return o},t}(),O=function(){function t(t,e,r){this.matrix=t,this.matrixTransform=e,this.cursor=r,this.size=40,this.observer=null}return t.prototype.observe=function(t){this.observer=t},t.prototype.click=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e);var r=this.matrix.getMatrixXYByClientXY(t,e),o=r.x,i=r.y;this.addCylinder(o,i)},t.prototype.move=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e);var r=this.size*this.matrix.cellSize,o=r/2;this.cursor.drawRect(t-r,e-o,2*r,r,d)},t.prototype.leave=function(){this.cursor.clear()},t.prototype.correctPosition=function(t){t*=2;var e=2*this.matrix.cellSize;return Math.round(t/e)*e},t.prototype.addCylinder=function(t,e){var r=(new H).generateVertical(this.size-1,this.size),o=this.size/2;this.matrixTransform.merge(r,2*Math.round((t-this.size)/2),2*Math.round((e-o)/2),2*Math.round((20-this.size)/2)),null!==this.observer&&this.observer()},t}(),X=function(){function t(){}return t.prototype.fill=function(t){for(var e=t.matrix,r=0;r<t.cols;r++)for(var o=0;o<t.levels;o++)for(var i=5*Math.sin(r/t.cols*Math.PI),n=Math.round(t.rows-1-i);n<t.rows;n++)e[n][r][o]=new P},t}();!function(t){t.SPHERE="sphere",t.CIRCLE="circle",t.CYLINDER="cylinder",t.RECT="rect",t.CONE="cone"}(s||(s={}));var B,q=function(){function t(t,e,r){this.matrix=t,this.matrixTransform=e,this.cursor=r,this.size=20,this.observer=null}return t.prototype.observe=function(t){this.observer=t},t.prototype.click=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e);var r=this.matrix.getMatrixXYByClientXY(t,e),o=r.x,i=r.y;this.addCircle(o,i)},t.prototype.move=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e),this.cursor.drawCircle(t,e,this.size*this.matrix.cellSize,d)},t.prototype.leave=function(){this.cursor.clear()},t.prototype.correctPosition=function(t){t*=2;var e=2*this.matrix.cellSize;return Math.round(t/e)*e},t.prototype.addCircle=function(t,e){this.matrixTransform.merge((new H).generateHorizontal(this.size,this.size),t-this.size,e-this.size,20-this.size),null!==this.observer&&this.observer()},t}(),F=function(){function t(){}return t.prototype.generate=function(t,e){for(var r=1+(t<<1),o=new v(r,e,r),i=new w(o),n=t,s=1;s<e;s++){var a=Math.round(t*(s/(e-1)));i.merge((new z).generateYAxis(a),n-a,s,n-a)}return o},t}(),N=function(){function t(t,e,r){this.matrix=t,this.matrixTransform=e,this.cursor=r,this.size=20,this.observer=null}return t.prototype.observe=function(t){this.observer=t},t.prototype.click=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e);var r=this.matrix.getMatrixXYByClientXY(t,e),o=r.x,i=r.y;this.addCone(o,i)},t.prototype.move=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e);var r=this.size*this.matrix.cellSize,o=r<<1;this.cursor.drawTriangle(t-r,e-r,o,o,d)},t.prototype.leave=function(){this.cursor.clear()},t.prototype.correctPosition=function(t){t*=2;var e=2*this.matrix.cellSize;return Math.round(t/e)*e},t.prototype.addCone=function(t,e){this.matrixTransform.merge((new F).generate(this.size,2*this.size),t-this.size,e-this.size,20-this.size),null!==this.observer&&this.observer()},t}(),j=function(){function t(t,e,r){this.matrix=t,this.matrixTransform=e,this.cursor=r,this.size=7,this.observer=null}return t.prototype.observe=function(t){this.observer=t},t.prototype.click=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e);var r=this.matrix.getMatrixXYByClientXY(t,e),o=r.x,i=r.y;this.excludeSphere(o,i)},t.prototype.move=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e),this.cursor.drawCircle(t,e,this.size*this.matrix.cellSize,p)},t.prototype.leave=function(){this.cursor.clear()},t.prototype.correctPosition=function(t){t*=2;var e=2*this.matrix.cellSize;return Math.round(t/e)*e},t.prototype.excludeSphere=function(t,e){this.matrixTransform.excludeNearest((new H).generateHorizontal(this.size,this.size),t,e),null!==this.observer&&this.observer()},t}(),V=function(){function t(t,e,r){this.matrix=t,this.matrixTransform=e,this.cursor=r,this.size=7,this.observer=null}return t.prototype.observe=function(t){this.observer=t},t.prototype.click=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e);var r=this.matrix.getMatrixXYByClientXY(t,e),o=r.x,i=r.y;this.excludeSphere(o,i)},t.prototype.move=function(t,e){t=this.correctPosition(t),e=this.correctPosition(e);var r=this.size*this.matrix.cellSize,o=r/2;this.cursor.drawRect(t-o,e-o,r,r,p)},t.prototype.leave=function(){this.cursor.clear()},t.prototype.correctPosition=function(t){t*=2;var e=2*this.matrix.cellSize;return Math.round(t/e)*e},t.prototype.excludeSphere=function(t,e){this.matrixTransform.excludeNearest((new R).generate(this.size),t,e),null!==this.observer&&this.observer()},t}();!function(t){t[t.ADD=0]="ADD",t[t.ERASE=1]="ERASE",t[t.PAINT=2]="PAINT",t[t.PROPS=3]="PROPS"}(B||(B={}));var W=function(){function t(t,e,r,o,i,n){var a=this;this.cont=t,this.scene=e,this.matrix=r,this.cursor=o,this.matrixHistory=i,this.props=n,this.lastAddShape=s.SPHERE,this.lastEraseShape=s.SPHERE,this.lastPaintShape=s.CIRCLE,this.processChange=function(){a.scene.requestRender(),a.matrixHistory.saveState()},this.pointerService=new D(this.cursor.canvas);var l=new w(this.matrix,this.matrixHistory,this.props);this.addBallTool=new E(this.matrix,l,this.cursor),this.addBallTool.observe(this.processChange),this.addCubeTool=new A(this.matrix,l,this.cursor),this.addCubeTool.observe(this.processChange),this.addCylinderTool=new O(this.matrix,l,this.cursor),this.addCylinderTool.observe(this.processChange),this.addCircleTool=new q(this.matrix,l,this.cursor),this.addCircleTool.observe(this.processChange),this.addConeTool=new N(this.matrix,l,this.cursor),this.addConeTool.observe(this.processChange),this.eraseBallTool=new I(this.matrix,l,this.cursor),this.eraseBallTool.observe(this.processChange),this.eraseCircleTool=new j(this.matrix,l,this.cursor),this.eraseCircleTool.observe(this.processChange),this.eraseRectTool=new V(this.matrix,l,this.cursor),this.eraseRectTool.observe(this.processChange),this.addPropTool=new L(this.matrix,this.matrixHistory,this.cursor,this.props),this.addPropTool.observe(this.processChange),this.paintTool=new Y(this.matrix,this.matrixHistory,this.cursor),this.paintTool.observe(this.processChange),this.mount(),this.setBrushSize(7)}return t.prototype.setBrushSize=function(t){var e=2*t;this.addBallTool.size=e,this.addCubeTool.size=e,this.addCylinderTool.size=e,this.addCircleTool.size=e,this.addConeTool.size=e,this.eraseBallTool.size=e,this.eraseCircleTool.size=e,this.eraseRectTool.size=e,this.paintTool.size=e/2,this.selectSize(t)},t.prototype.setAddSnowTool=function(){this.currentTool=B.ADD,this.showShapes([s.SPHERE,s.CIRCLE,s.RECT,s.CONE,s.CYLINDER]),this.setShape(this.lastAddShape),this.selectTool("add")},t.prototype.setEraseTool=function(){this.currentTool=B.ERASE,this.showShapes([s.SPHERE,s.CIRCLE,s.RECT]),this.setShape(this.lastEraseShape),this.selectTool("erase")},t.prototype.setPaintTool=function(){this.currentTool=B.PAINT,this.showShapes([s.CIRCLE]),this.setShape(this.lastPaintShape),this.selectTool("paint")},t.prototype.setPropTool=function(){this.currentTool=B.PROPS,this.showShapes([]),this.selectTool("props")},t.prototype.setShape=function(t){var e;if(this.selectShape(t),this.currentTool===B.ADD){switch(t){case s.SPHERE:e=this.addBallTool;break;case s.RECT:e=this.addCubeTool;break;case s.CYLINDER:e=this.addCylinderTool;break;case s.CIRCLE:e=this.addCircleTool;break;case s.CONE:e=this.addConeTool}this.lastAddShape=t}else if(this.currentTool===B.ERASE){switch(t){case s.SPHERE:e=this.eraseBallTool;break;case s.CIRCLE:e=this.eraseCircleTool;break;case s.RECT:e=this.eraseRectTool}this.lastEraseShape=t}else this.currentTool===B.PAINT&&(t===s.CIRCLE&&(e=this.paintTool),this.lastPaintShape=t);e&&this.pointerService.setHandler(e)},t.prototype.setAddPropTool=function(t,e){return r=this,o=void 0,n=function(){var r;return function(t,e){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;n&&(n=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(o){switch(o.label){case 0:return null!==this.props.getPropByCode(e)?[3,2]:[4,this.props.setProp(e,t)];case 1:o.sent(),o.label=2;case 2:return this.addPropTool.setPropCode(e),this.pointerService.setHandler(this.addPropTool),(r=this.cont.querySelector(".snow-editor-prop_selected"))&&r.classList.remove("snow-editor-prop_selected"),this.cont.querySelector('.snow-editor-prop[data-value="'.concat(e,'"]')).classList.toggle("snow-editor-prop_selected"),this.cont.querySelector(".snow-editor__props").classList.remove("snow-editor__props_show"),[2]}}))},new((i=void 0)||(i=Promise))((function(t,e){function s(t){try{l(n.next(t))}catch(t){e(t)}}function a(t){try{l(n.throw(t))}catch(t){e(t)}}function l(e){var r;e.done?t(e.value):(r=e.value,r instanceof i?r:new i((function(t){t(r)}))).then(s,a)}l((n=n.apply(r,o||[])).next())}));var r,o,i,n},t.prototype.setColorTool=function(t){this.paintTool.setColor(u[t][0],u[t][1]),this.pointerService.setHandler(this.paintTool);var e=this.cont.querySelector(".snow-editor-color_selected");e&&e.classList.remove("snow-editor-color_selected"),this.cont.querySelector('.snow-editor-color[data-value="'.concat(t+1,'"]')).classList.toggle("snow-editor-color_selected"),this.cont.querySelector(".snow-editor__colors").classList.remove("snow-editor__colors_show")},t.prototype.mount=function(){var t=this;this.cont.querySelectorAll(".snow-editor-tool").forEach((function(e){switch(e.dataset.role){case"add":e.onclick=function(){return t.setAddSnowTool()};break;case"erase":e.onclick=function(){return t.setEraseTool()};break;case"paint":e.onclick=function(){return t.setPaintTool()};break;case"props":e.onclick=function(){return t.setPropTool()}}})),this.cont.querySelectorAll(".snow-editor__size").forEach((function(e){e.onclick=function(){return t.setBrushSize(parseInt(e.dataset.value,10))}})),this.cont.querySelectorAll(".snow-editor-color").forEach((function(e){e.onclick=function(){return t.setColorTool(parseInt(e.dataset.value,10)-1)}})),this.cont.querySelectorAll(".snow-editor-prop").forEach((function(e){e.onclick=function(){return t.setAddPropTool(window.getComputedStyle(e).backgroundImage.match(/url\(["']?([^"')]+)["']?\)/)[1],parseInt(e.dataset.value,10))}})),this.cont.querySelectorAll(".snow-editor__shape").forEach((function(e){e.onclick=function(){return t.setShape(e.dataset.shape)}})),this.cont.querySelector('.snow-editor-button[data-role="undo"]').onclick=function(){"structuredClone"in window?(t.matrixHistory.restoreState(),t.scene.requestRender()):alert("Ваш браузер не поддерживает эту функцию")},this.cont.querySelector('.snow-editor-button[data-role="clear"]').onclick=function(){confirm("Вы действительно хотите удалить все?")&&(t.matrix.clear(),(new X).fill(t.matrix),t.matrixHistory.reset(),t.scene.requestRender())}},t.prototype.showShapes=function(t){document.querySelectorAll(".snow-editor__shape").forEach((function(e){e.hidden=!t.includes(e.dataset.shape)}))},t.prototype.selectTool=function(t){var e=this.cont.querySelector(".snow-editor-tool_selected");e&&e.classList.remove("snow-editor-tool_selected"),this.cont.querySelector(".snow-editor__colors").classList.toggle("snow-editor__colors_show","paint"===t),this.cont.querySelector(".snow-editor__props").classList.toggle("snow-editor__props_show","props"===t),this.cont.querySelector('.snow-editor-tool[data-role="'.concat(t,'"]')).classList.add("snow-editor-tool_selected")},t.prototype.selectSize=function(t){var e=this.cont.querySelector(".snow-editor__size_selected");e&&e.classList.remove("snow-editor__size_selected"),this.cont.querySelector('.snow-editor__size[data-value="'.concat(t,'"]')).classList.add("snow-editor__size_selected")},t.prototype.selectShape=function(t){var e=this.cont.querySelector(".snow-editor__shape_selected");e&&e.classList.remove("snow-editor__shape_selected"),this.cont.querySelector('.snow-editor__shape[data-shape="'.concat(t,'"]')).classList.add("snow-editor__shape_selected")},t}(),G=function(){this.showRenderAreas=!1},Z=r(982),U=r.n(Z),J=function(){function t(t){this.matrix=t,this.isSavedToServer=!0,this.history=[],"structuredClone"in window&&(this.prevState=structuredClone(this.matrix.matrix))}return t.prototype.reset=function(){this.history=[],this.isSavedToServer=!1,this.prevState=structuredClone(this.matrix.matrix)},t.prototype.hasChanges=function(){return this.history.length>0},t.prototype.saveState=function(){if("structuredClone"in window){this.isSavedToServer=!1;for(var t=this.matrix.matrix,e=[],r=0;r<this.matrix.rows;r++)for(var o=t[r],i=this.prevState[r],n=0;n<this.matrix.cols;n++)for(var s=o[n],a=i[n],l=0;l<this.matrix.levels;l++){var c=s[l],h=a[l];null===c?null!==h&&(a[l]=null,e.push({x:n,y:r,z:l,cell:h})):null===h?(a[l]=structuredClone(c),e.push({x:n,y:r,z:l,cell:null})):c.hash!==h.hash&&(a[l]=structuredClone(c),e.push({x:n,y:r,z:l,cell:h}))}console.log("save changes ",e.length),this.history.push(e),this.history.length>20&&this.history.shift()}},t.prototype.restoreState=function(){if(!(this.history.length<1)){this.isSavedToServer=!1;for(var t=this.history.pop(),e=this.prevState,r=this.matrix.matrix,o=0,i=t;o<i.length;o++){var n=i[o];e[n.y][n.x][n.z]=n.cell}for(var s=0;s<this.matrix.rows;s++)for(var a=r[s],l=e[s],c=0;c<this.matrix.cols;c++)for(var h=a[c],u=l[c],d=0;d<this.matrix.levels;d++){var p=h[d],f=u[d];null===p?null!==f&&(h[d]=structuredClone(f)):null===f?h[d]=null:p.hash!==f.hash&&(h[d]=structuredClone(f))}this.matrix.setInitialChangedCube(),this.matrix.resetCache()}},t}(),K=function(){function t(){this.props=new Map}return t.prototype.getPropByCode=function(t){return this.props.get(t)||null},t.prototype.setProp=function(t,e){return r=this,o=void 0,n=function(){var r=this;return function(t,e){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;n&&(n=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(o){return[2,new Promise((function(o){var i=new Image;i.crossOrigin="anonymous",i.onload=function(){return o(i)},i.src=e,r.props.set(t,i)}))]}))},new((i=void 0)||(i=Promise))((function(t,e){function s(t){try{l(n.next(t))}catch(t){e(t)}}function a(t){try{l(n.throw(t))}catch(t){e(t)}}function l(e){var r;e.done?t(e.value):(r=e.value,r instanceof i?r:new i((function(t){t(r)}))).then(s,a)}l((n=n.apply(r,o||[])).next())}));var r,o,i,n},t}(),Q=function(t,e,r){if(r||2===arguments.length)for(var o,i=0,n=e.length;i<n;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},$=function(){function t(t,e,r,o){var i=this;this.cont=t,this.matrix=e,this.history=r,this.userId=o,this.saveBtn=this.cont.querySelector('button[data-role="save"]'),this.saveBtn.onclick=function(){return i.save()}}return t.prototype.save=function(){return t=this,e=void 0,o=function(){var t,e,r,o,i,n,s,a,l,c,h;return function(t,e){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;n&&(n=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(u){switch(u.label){case 0:if(0===this.userId)return[2];for(this.saveBtn.disabled=!0,this.cont.querySelectorAll('.snow-editor__message[data-group="save"]').forEach((function(t){return t.hidden=!0})),t=[],e=this.matrix.matrix,r=0;r<this.matrix.rows;r++)for(o=e[r],i=0;i<this.matrix.cols;i++)for(n=o[i],s=0;s<this.matrix.levels;s++)null!==(a=n[s])&&t.push.apply(t,Q(Q(Q([r,i,s,Math.floor(10*a.extraRadius),Math.floor(255*a.darkness)],null===a.colorLight?[0,0,0,0]:a.colorLight,!1),null===a.colorDark?[0,0,0,0]:a.colorDark,!1),[a.prop],!1));this.history.isSavedToServer=!0,(l=new FormData).append("f",new Blob([new Uint8Array(t)])),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,fetch("./save.ajax.php",{method:"POST",body:l})];case 2:return[4,u.sent().json()];case 3:return(c=u.sent()).result?[3,5]:(console.error(c.message),this.saveBtn.disabled=!1,this.showError(),[2]);case 4:return h=u.sent(),console.error(h),this.saveBtn.disabled=!1,this.showError(),[2];case 5:return this.showSuccess(),this.saveBtn.disabled=!1,[2]}}))},new((r=void 0)||(r=Promise))((function(i,n){function s(t){try{l(o.next(t))}catch(t){n(t)}}function a(t){try{l(o.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}));var t,e,r,o},t.prototype.showError=function(){this.cont.querySelectorAll('.snow-editor__message[data-group="save"]').forEach((function(t){return t.hidden=t.classList.contains("snow-editor__message_success")}))},t.prototype.showSuccess=function(){this.cont.querySelectorAll('.snow-editor__message[data-group="save"]').forEach((function(t){return t.hidden=t.classList.contains("snow-editor__message_error")}))},t}(),tt=function(){function t(t,e){var r=this;this.cont=t,this.userId=e,this.destroyDtn=this.cont.querySelector('button[data-role="destroy"]'),this.destroyDtn.onclick=function(){return r.destroy()}}return t.prototype.destroy=function(){return t=this,e=void 0,o=function(){var t,e;return function(t,e){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;n&&(n=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(r){switch(r.label){case 0:if(0===this.userId)return[2];this.destroyDtn.disabled=!0,this.cont.querySelectorAll('.snow-editor__message[data-group="destroy"]').forEach((function(t){return t.hidden=!0})),r.label=1;case 1:return r.trys.push([1,4,,5]),[4,fetch("./destroy.ajax.php",{method:"POST"})];case 2:return[4,r.sent().json()];case 3:return(t=r.sent()).result?[3,5]:(console.error(t.message),this.destroyDtn.disabled=!1,this.showError(),[2]);case 4:return e=r.sent(),console.error(e),this.destroyDtn.disabled=!1,this.showError(),[2];case 5:return this.showSuccess(),this.destroyDtn.disabled=!1,[2]}}))},new((r=void 0)||(r=Promise))((function(i,n){function s(t){try{l(o.next(t))}catch(t){n(t)}}function a(t){try{l(o.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}));var t,e,r,o},t.prototype.showError=function(){this.cont.querySelectorAll('.snow-editor__message[data-group="destroy"]').forEach((function(t){return t.hidden=t.classList.contains("snow-editor__message_success")}))},t.prototype.showSuccess=function(){this.cont.querySelectorAll('.snow-editor__message[data-group="destroy"]').forEach((function(t){return t.hidden=t.classList.contains("snow-editor__message_error")}))},t}(),et=function(t,e){var r,o,i=this;this.el=(r=U()({userId:t,userName:e,props:new Array(84).fill(null).map((function(t,e){return{i:e+1}}))}),(o=document.createElement("template")).innerHTML=r,o.content.firstElementChild),this.props=new K,this.matrix=new v(90,130,40),(new X).fill(this.matrix),this.matrixHistory=new J(this.matrix),this.renderOptions=new G,this.renderer=new _(this.matrix,this.renderOptions,this.props),this.cursor=new S(this.renderer,this.matrix),this.scene=new C(this.matrix,this.matrixHistory,this.renderer),this.tools=new W(this.el,this.scene,this.matrix,this.cursor,this.matrixHistory,this.props),this.save=new $(this.el,this.matrix,this.matrixHistory,t),this.destroy=new tt(this.el,t);var n=this.el.querySelector(".snow-editor__canvas");n.appendChild(this.renderer.canvas),n.appendChild(this.cursor.canvas),window.addEventListener("beforeunload",(function(t){return!i.matrixHistory.hasChanges()||i.matrixHistory.isSavedToServer?null:(t.returnValue="","")})),this.tools.setAddSnowTool()},rt=function(){function t(){this.props=new K,this.matrix=new v(90,130,40);var t=new J(this.matrix),e=new G,r=new _(this.matrix,e,this.props,!0);this.scene=new C(this.matrix,t,r),this.el=r.canvas}return t.prototype.load=function(t){return e=this,r=void 0,i=function(){return function(t,e){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;n&&(n=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(e){switch(e.label){case 0:return[4,this.parseData(t)];case 1:return e.sent(),this.matrix.setInitialChangedCube(),this.matrix.resetCache(),this.scene.requestRender(),[2]}}))},new((o=void 0)||(o=Promise))((function(t,n){function s(t){try{l(i.next(t))}catch(t){n(t)}}function a(t){try{l(i.throw(t))}catch(t){n(t)}}function l(e){var r;e.done?t(e.value):(r=e.value,r instanceof o?r:new o((function(t){t(r)}))).then(s,a)}l((i=i.apply(e,r||[])).next())}));var e,r,o,i},t.prototype.parseData=function(t){for(var e=Uint8Array.from(window.atob(t),(function(t){return t.charCodeAt(0)})),r=new Set,o=[],i=0;i<e.length;i+=14){var n=e[i],s=e[i+1],a=e[i+2],l=this.matrix.matrix[n][s][a]=new P;l.extraRadius=e[i+3]/10,l.darkness=e[i+4]/255,0!==e[i+8]&&(l.colorLight=[e[i+5],e[i+6],e[i+7],e[i+8]]),0!==e[i+12]&&(l.colorDark=[e[i+9],e[i+10],e[i+11],e[i+12]]),l.prop=e[i+13],l.prop>0&&!r.has(l.prop)&&(r.add(l.prop),o.push(this.props.setProp(l.prop,"assets/prop".concat(l.prop,".png"))))}return 0===o.length?Promise.resolve():Promise.all(o)},t}();document.addEventListener("DOMContentLoaded",(function(){var t=document.querySelector(".snow-editor-container");if(t){var e=new et(parseInt(t.dataset.userId,10),t.dataset.userName);t.appendChild(e.el)}var r=document.querySelector(".snow-view-container");if(r){var o=new rt;o.load(document.querySelector("script#snow-data").textContent).then(),r.appendChild(o.el)}}))})()})();
//# sourceMappingURL=main.js.map